
------------------------------------------------------------
SQL Script to Create Database and Tables
------------------------------------------------------------

CREATE DATABASE HotelBooking;
USE HotelBooking;

-- Table: users
CREATE TABLE users (
    user_id INT(11) AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100),
    password VARCHAR(255),
    level TINYINT(1),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    user_image VARCHAR(255)
);

-- Table: hotels
CREATE TABLE hotels (
    hotel_id INT(11) AUTO_INCREMENT PRIMARY KEY,
    hotel_name VARCHAR(150),
    location VARCHAR(150),
    total_rooms INT(11),
    available_rooms INT(11),
    price_per_room DECIMAL(10,2),
    description TEXT,
    created_by INT(11),
    hotel_image VARCHAR(255),
    FOREIGN KEY (created_by) REFERENCES users(user_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- Table: bookings
CREATE TABLE bookings (
    booking_id INT(11) AUTO_INCREMENT PRIMARY KEY,
    user_id INT(11),
    hotel_id INT(11),
    rooms_booked INT(11),
    check_in DATE,
    check_out DATE,
    status ENUM('booked','cancel_requested','canceled') DEFAULT 'booked',
    booked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (hotel_id) REFERENCES hotels(hotel_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- Table: invoices
CREATE TABLE invoices (
    invoice_id INT(11) AUTO_INCREMENT PRIMARY KEY,
    booking_id INT(11),
    total_amount DECIMAL(10,2),
    payment_status ENUM('paid','pending') DEFAULT 'pending',
    generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (booking_id) REFERENCES bookings(booking_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- Table: payments
CREATE TABLE payments (
    payment_id INT(11) AUTO_INCREMENT PRIMARY KEY,
    booking_id INT(11),
    user_id INT(11),
    amount DECIMAL(10,2),
    payment_method VARCHAR(50),
    transaction_id VARCHAR(100),
    payment_status ENUM('pending','completed','failed') DEFAULT 'pending',
    payment_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (booking_id) REFERENCES bookings(booking_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);



/// aditional


CREATE TABLE bookings (
    booking_id INT(11) AUTO_INCREMENT PRIMARY KEY,
    user_id INT(11) NOT NULL,            -- FK to users table
    hotel_id INT(11) NOT NULL,           -- FK to hotels table
    room_id INT(11) NOT NULL,            -- FK to hotel_room table
    rooms_booked INT(11) NOT NULL,       -- number of rooms booked
    check_in DATE NOT NULL,
    check_out DATE NOT NULL,
    status ENUM('booked','cancel_requested','canceled') DEFAULT 'booked',
    booked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- Foreign Key Constraints
    CONSTRAINT fk_booking_user FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    CONSTRAINT fk_booking_hotel FOREIGN KEY (hotel_id) REFERENCES hotels(hotel_id) ON DELETE CASCADE,
    CONSTRAINT fk_booking_room FOREIGN KEY (room_id) REFERENCES hotel_room(room_id) ON DELETE CASCADE
);
